# ğŸš€ ZKFair L2 - æ–°äººå¿«é€Ÿå…¥é—¨æŒ‡å—

> è®©æ‚¨åœ¨30åˆ†é’Ÿå†…ç†è§£æ•´ä¸ªé¡¹ç›®ï¼

## ğŸ“– ç›®å½•

1. [é¡¹ç›®æ˜¯ä»€ä¹ˆï¼Ÿ](#1-é¡¹ç›®æ˜¯ä»€ä¹ˆ)
2. [ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªï¼Ÿ](#2-ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ª)
3. [æŠ€æœ¯æ¶æ„æ€»è§ˆ](#3-æŠ€æœ¯æ¶æ„æ€»è§ˆ)
4. [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#4-æ ¸å¿ƒç»„ä»¶è¯¦è§£)
5. [å¿«é€Ÿå¼€å§‹](#5-å¿«é€Ÿå¼€å§‹)
6. [å¼€å‘å·¥ä½œæµ](#6-å¼€å‘å·¥ä½œæµ)
7. [å¸¸è§é—®é¢˜](#7-å¸¸è§é—®é¢˜)
8. [ä¸‹ä¸€æ­¥å­¦ä¹ ](#8-ä¸‹ä¸€æ­¥å­¦ä¹ )

---

## 1. é¡¹ç›®æ˜¯ä»€ä¹ˆï¼Ÿ

### ä¸€å¥è¯è¯´æ˜
**ZKFair L2 æ˜¯ä¸€ä¸ªè®©ç”¨æˆ·å¯ä»¥ç”¨ç¨³å®šå¸ï¼ˆUSDC/USDTï¼‰æ”¯ä»˜gasè´¹çš„Layer 2åŒºå—é“¾ã€‚**

### é€šä¿—è§£é‡Š
æƒ³è±¡ä¸€ä¸‹ï¼š
- ä¼ ç»ŸåŒºå—é“¾ = é«˜é€Ÿå…¬è·¯ï¼ˆéœ€è¦ç”¨ä¸“é—¨çš„é€šè¡Œå¸ETHä»˜è´¹ï¼‰
- ZKFair L2 = æ™ºèƒ½é«˜é€Ÿå…¬è·¯ï¼ˆå¯ä»¥ç”¨ç¾å…ƒç¨³å®šå¸ä»˜è´¹ï¼‰

### æ ¸å¿ƒåˆ›æ–°
```
ä¼ ç»Ÿæ–¹å¼ï¼šç”¨æˆ· â†’ éœ€è¦ETH â†’ æ‰§è¡Œäº¤æ˜“ â†’ æ”¯ä»˜ETHä½œä¸ºgas
æˆ‘ä»¬çš„æ–¹å¼ï¼šç”¨æˆ· â†’ åªéœ€USDC â†’ æ‰§è¡Œäº¤æ˜“ â†’ è‡ªåŠ¨è½¬æ¢æ”¯ä»˜
```

## 2. ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªï¼Ÿ

### ç°æœ‰é—®é¢˜
1. **ç”¨æˆ·é—¨æ§›é«˜** - æ–°ç”¨æˆ·éœ€è¦å…ˆè´­ä¹°ETHæ‰èƒ½ä½¿ç”¨DApp
2. **ä»·æ ¼æ³¢åŠ¨å¤§** - ETHä»·æ ¼æ³¢åŠ¨å¯¼è‡´äº¤æ˜“æˆæœ¬ä¸å¯é¢„æµ‹  
3. **ç”¨æˆ·ä½“éªŒå·®** - éœ€è¦ç®¡ç†å¤šç§ä»£å¸

### æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆ
1. **é™ä½é—¨æ§›** - ç”¨æˆ·åªéœ€æŒæœ‰ç¨³å®šå¸å³å¯
2. **æˆæœ¬å¯é¢„æµ‹** - ç¨³å®šå¸ä»·æ ¼ç¨³å®šï¼Œgasè´¹ç”¨é€æ˜
3. **ä½“éªŒä¼˜åŒ–** - ä¸€ç§ä»£å¸å®Œæˆæ‰€æœ‰æ“ä½œ

## 3. æŠ€æœ¯æ¶æ„æ€»è§ˆ

### ä¸‰å¤§æ ¸å¿ƒæŠ€æœ¯

```mermaid
graph TB
    subgraph "ç”¨æˆ·å±‚"
        U[ç”¨æˆ·] -->|USDC/USDT| W[æ™ºèƒ½é’±åŒ…]
    end
    
    subgraph "è´¦æˆ·æŠ½è±¡å±‚ (ERC-4337)"
        W --> B[Bundler]
        B --> E[EntryPoint]
        E --> P[Paymaster]
        P -->|ä»£ä»˜Gas| E
    end
    
    subgraph "æ‰§è¡Œå±‚ (Polygon CDK)"
        E --> CDK[ZK-Rollup]
        CDK --> S[çŠ¶æ€è½¬æ¢]
        S --> ZK[é›¶çŸ¥è¯†è¯æ˜]
    end
    
    subgraph "æ•°æ®å¯ç”¨å±‚ (Celestia)"
        CDK --> C[Celestia DA]
        C -->|å­˜å‚¨äº¤æ˜“æ•°æ®| CB[CelestiaåŒºå—é“¾]
    end
```

### æŠ€æœ¯æ ˆåˆ†å±‚

| å±‚çº§ | æŠ€æœ¯ | ä½œç”¨ |
|------|------|------|
| å‰ç«¯ | React + TypeScript | ç”¨æˆ·ç•Œé¢ |
| SDK | TypeScript SDK | å¼€å‘è€…é›†æˆ |
| API | Node.js + Express | ä¸šåŠ¡é€»è¾‘ |
| æ™ºèƒ½åˆçº¦ | Solidity | é“¾ä¸Šé€»è¾‘ |
| Layer 2 | Polygon CDK | æ‰©å®¹æ–¹æ¡ˆ |
| æ•°æ®å¯ç”¨æ€§ | Celestia | é™ä½æˆæœ¬ |

## 4. æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 4.1 æ™ºèƒ½åˆçº¦ (`/contracts`)

#### EntryPointåˆçº¦
```solidity
// æ ¸å¿ƒåŠŸèƒ½ï¼šå¤„ç†ç”¨æˆ·æ“ä½œ
contract EntryPoint {
    // éªŒè¯å¹¶æ‰§è¡Œç”¨æˆ·æ“ä½œ
    function handleOps(UserOperation[] ops);
    // ç®¡ç†è´¦æˆ·å­˜æ¬¾
    function depositTo(address account);
}
```

#### Paymasteråˆçº¦
```solidity
// æ ¸å¿ƒåŠŸèƒ½ï¼šä»£ä»˜gasè´¹
contract Paymaster {
    // éªŒè¯æ˜¯å¦æ„¿æ„ä¸ºç”¨æˆ·æ”¯ä»˜gas
    function validatePaymasterUserOp(UserOp op);
    // ä»ç”¨æˆ·çš„ç¨³å®šå¸ä¸­æ‰£è´¹
    function postOp(mode, context, actualGasCost);
}
```

#### æ™ºèƒ½é’±åŒ…
```solidity
// æ ¸å¿ƒåŠŸèƒ½ï¼šç”¨æˆ·çš„æ™ºèƒ½åˆçº¦é’±åŒ…
contract SmartWallet {
    // æ‰§è¡Œç”¨æˆ·äº¤æ˜“
    function execute(address to, uint256 value, bytes data);
    // æ‰¹é‡æ‰§è¡Œ
    function executeBatch(address[] to, bytes[] data);
}
```

### 4.2 åç«¯æœåŠ¡ (`/backend`)

```typescript
// APIç«¯ç‚¹ç¤ºä¾‹
POST   /api/wallet/create      // åˆ›å»ºé’±åŒ…
POST   /api/transaction/send   // å‘é€äº¤æ˜“
GET    /api/wallet/:address    // æŸ¥è¯¢é’±åŒ…
WS     /ws/subscribe           // å®æ—¶è®¢é˜…
```

### 4.3 BundleræœåŠ¡ (`/bundler`)

```typescript
// æ‰“åŒ…ç”¨æˆ·æ“ä½œå¹¶æäº¤åˆ°é“¾ä¸Š
class Bundler {
    collectUserOps()     // æ”¶é›†æ“ä½œ
    validateUserOps()    // éªŒè¯æ“ä½œ
    bundleUserOps()      // æ‰“åŒ…æ“ä½œ
    submitToChain()      // æäº¤ä¸Šé“¾
}
```

### 4.4 å‰ç«¯åº”ç”¨ (`/frontend`)

```typescript
// ä¸»è¦é¡µé¢
/                    // é¦–é¡µ
/wallet              // é’±åŒ…ç®¡ç†
/swap                // ä»£å¸å…‘æ¢
/transactions        // äº¤æ˜“å†å²
```

### 4.5 ç›‘æ§ç³»ç»Ÿ (`/monitoring`)

```yaml
Prometheus:  æ”¶é›†æŒ‡æ ‡
Grafana:     å¯è§†åŒ–å±•ç¤º
AlertManager: å‘Šè­¦é€šçŸ¥
```

## 5. å¿«é€Ÿå¼€å§‹

### 5.1 ç¯å¢ƒå‡†å¤‡

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository>
cd zkfair

# 2. å®‰è£…ä¾èµ–
npm install            # å‰ç«¯/åç«¯
forge install          # æ™ºèƒ½åˆçº¦

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶
```

### 5.2 æœ¬åœ°è¿è¡Œ

```bash
# 1. å¯åŠ¨åŸºç¡€è®¾æ–½
docker-compose up -d postgres redis

# 2. éƒ¨ç½²åˆçº¦ï¼ˆæœ¬åœ°æµ‹è¯•ç½‘ï¼‰
cd contracts
forge script script/Deploy.s.sol --rpc-url localhost --broadcast

# 3. å¯åŠ¨åç«¯
cd backend
npm run dev

# 4. å¯åŠ¨å‰ç«¯
cd frontend
npm run dev

# 5. å¯åŠ¨bundler
cd bundler
npm run dev
```

### 5.3 æµ‹è¯•æµç¨‹

```bash
# 1. è¿è¡Œåˆçº¦æµ‹è¯•
forge test -vvv

# 2. åˆ›å»ºæµ‹è¯•é’±åŒ…
curl -X POST http://localhost:3001/api/wallet/create \
  -H "Content-Type: application/json" \
  -d '{"owner": "0x..."}'

# 3. å‘é€æµ‹è¯•äº¤æ˜“
# ä½¿ç”¨å‰ç«¯ç•Œé¢æˆ–API
```

## 6. å¼€å‘å·¥ä½œæµ

### 6.1 é¡¹ç›®ç»“æ„

```
zkfair/
â”œâ”€â”€ contracts/          # æ™ºèƒ½åˆçº¦
â”‚   â”œâ”€â”€ src/           # åˆçº¦æºç 
â”‚   â”œâ”€â”€ test/          # åˆçº¦æµ‹è¯•
â”‚   â””â”€â”€ script/        # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ frontend/          # Reactå‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/  # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/      # é¡µé¢
â”‚   â”‚   â””â”€â”€ hooks/      # Hooks
â”œâ”€â”€ backend/           # APIæœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/     # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ services/   # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ models/     # æ•°æ®æ¨¡å‹
â”œâ”€â”€ bundler/           # BundleræœåŠ¡
â”œâ”€â”€ sdk/               # å¼€å‘è€…SDK
â””â”€â”€ monitoring/        # ç›‘æ§é…ç½®
```

### 6.2 å¼€å‘æµç¨‹

1. **ç†è§£éœ€æ±‚**
   ```
   ç”¨æˆ·æ•…äº‹ â†’ æŠ€æœ¯æ–¹æ¡ˆ â†’ å®ç°è®¡åˆ’
   ```

2. **ç¼–å†™ä»£ç **
   ```
   TDD: æµ‹è¯• â†’ å®ç° â†’ é‡æ„
   ```

3. **æµ‹è¯•éªŒè¯**
   ```
   å•å…ƒæµ‹è¯• â†’ é›†æˆæµ‹è¯• â†’ E2Eæµ‹è¯•
   ```

4. **ä»£ç å®¡æŸ¥**
   ```
   æäº¤PR â†’ å®¡æŸ¥ â†’ åˆå¹¶
   ```

### 6.3 å¸¸ç”¨å‘½ä»¤

```bash
# åˆçº¦å¼€å‘
forge build              # ç¼–è¯‘åˆçº¦
forge test              # è¿è¡Œæµ‹è¯•
forge fmt               # æ ¼å¼åŒ–ä»£ç 

# å‰ç«¯å¼€å‘
npm run dev             # å¼€å‘æœåŠ¡å™¨
npm run build           # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run lint            # ä»£ç æ£€æŸ¥

# åç«¯å¼€å‘
npm run dev             # å¼€å‘æœåŠ¡å™¨
npm run test            # è¿è¡Œæµ‹è¯•
npm run migrate         # æ•°æ®åº“è¿ç§»
```

## 7. å¸¸è§é—®é¢˜

### Q1: ç”¨æˆ·çš„ç¨³å®šå¸æ˜¯å¦‚ä½•è½¬æ¢æˆETHæ”¯ä»˜gasçš„ï¼Ÿ

**ç­”æ¡ˆ**ï¼šé€šè¿‡Paymasteråˆçº¦
```
1. ç”¨æˆ·å‘èµ·äº¤æ˜“ï¼ˆä½¿ç”¨USDCï¼‰
2. PaymasteréªŒè¯ç”¨æˆ·ä½™é¢
3. Paymasterä»£ä»˜ETHä½œä¸ºgas
4. äº¤æ˜“å®Œæˆåï¼ŒPaymasterä»ç”¨æˆ·æ‰£é™¤ç­‰å€¼USDC
```

### Q2: ä¸ºä»€ä¹ˆéœ€è¦Bundlerï¼Ÿ

**ç­”æ¡ˆ**ï¼šERC-4337çš„æ ¸å¿ƒç»„ä»¶
```
- æ”¶é›†å¤šä¸ªç”¨æˆ·æ“ä½œ
- æ‰“åŒ…æˆä¸€ä¸ªäº¤æ˜“
- æé«˜æ•ˆç‡ï¼Œé™ä½æˆæœ¬
```

### Q3: Celestiaæ˜¯åšä»€ä¹ˆçš„ï¼Ÿ

**ç­”æ¡ˆ**ï¼šæ•°æ®å¯ç”¨æ€§å±‚
```
- å­˜å‚¨äº¤æ˜“æ•°æ®
- æ¯”ä»¥å¤ªåŠä¾¿å®œ95%
- ä¿è¯æ•°æ®å¯éªŒè¯
```

### Q4: é›¶çŸ¥è¯†è¯æ˜åœ¨å“ªé‡Œä½¿ç”¨ï¼Ÿ

**ç­”æ¡ˆ**ï¼šPolygon CDKä¸­
```
- è¯æ˜çŠ¶æ€è½¬æ¢çš„æ­£ç¡®æ€§
- æ— éœ€æš´éœ²äº¤æ˜“ç»†èŠ‚
- æé«˜éšç§å’Œæ•ˆç‡
```

## 8. ä¸‹ä¸€æ­¥å­¦ä¹ 

### 8.1 æ·±å…¥å­¦ä¹ è·¯å¾„

1. **æ™ºèƒ½åˆçº¦å¼€å‘**
   - å­¦ä¹ Solidity
   - ç†è§£ERC-4337æ ‡å‡†
   - é˜…è¯»åˆçº¦æºç 

2. **åç«¯å¼€å‘**
   - Node.js + TypeScript
   - æ•°æ®åº“è®¾è®¡
   - APIè®¾è®¡æ¨¡å¼

3. **å‰ç«¯å¼€å‘**
   - Reactç”Ÿæ€
   - Web3é›†æˆ
   - ç”¨æˆ·ä½“éªŒè®¾è®¡

4. **åŒºå—é“¾åŸç†**
   - Layer 2æ‰©å®¹æ–¹æ¡ˆ
   - é›¶çŸ¥è¯†è¯æ˜
   - æ•°æ®å¯ç”¨æ€§

### 8.2 æ¨èèµ„æº

#### å®˜æ–¹æ–‡æ¡£
- [ERC-4337è§„èŒƒ](https://eips.ethereum.org/EIPS/eip-4337)
- [Polygon CDKæ–‡æ¡£](https://wiki.polygon.technology/docs/cdk/)
- [Celestiaæ–‡æ¡£](https://docs.celestia.org/)

#### é¡¹ç›®æ–‡æ¡£
- [æŠ€æœ¯æ¶æ„](./architecture.md)
- [APIå‚è€ƒ](./api-reference.md)
- [éƒ¨ç½²æŒ‡å—](./deployment-guide.md)

#### è§†é¢‘æ•™ç¨‹
- [Account Abstractionå…¥é—¨](https://www.youtube.com/watch?v=...)
- [Layer 2åŸç†è®²è§£](https://www.youtube.com/watch?v=...)

### 8.3 å‚ä¸è´¡çŒ®

1. **æ‰¾åˆ°æ„Ÿå…´è¶£çš„ä»»åŠ¡**
   ```bash
   # æŸ¥çœ‹å¾…åŠäº‹é¡¹
   grep -r "TODO" .
   # æŸ¥çœ‹GitHub Issues
   ```

2. **å¼€å§‹è´¡çŒ®**
   ```bash
   # Forké¡¹ç›®
   # åˆ›å»ºåˆ†æ”¯
   git checkout -b feature/your-feature
   # æäº¤PR
   ```

3. **ä»£ç è§„èŒƒ**
   - éµå¾ªé¡¹ç›®ä»£ç é£æ ¼
   - ç¼–å†™æµ‹è¯•
   - æ›´æ–°æ–‡æ¡£

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼Œç¡®ä¿ä½ å·²ç»ç†è§£é¡¹ç›®ï¼š

- [ ] ç†è§£ä¸‰å¤§æ ¸å¿ƒæŠ€æœ¯çš„ä½œç”¨
- [ ] èƒ½å¤Ÿè§£é‡Šç”¨æˆ·å¦‚ä½•ç”¨ç¨³å®šå¸ä»˜gas
- [ ] æˆåŠŸè¿è¡Œæœ¬åœ°å¼€å‘ç¯å¢ƒ
- [ ] å®Œæˆä¸€ç¬”æµ‹è¯•äº¤æ˜“
- [ ] ç†è§£ä¸»è¦åˆçº¦çš„åŠŸèƒ½
- [ ] çŸ¥é“å„ä¸ªæœåŠ¡çš„èŒè´£
- [ ] èƒ½å¤ŸæŸ¥çœ‹ç›‘æ§é¢æ¿

## ğŸ“ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜æ—¶ï¼š

1. **æŸ¥çœ‹æ–‡æ¡£** - `/docs`ç›®å½•
2. **æœç´¢ä»£ç ** - ä½¿ç”¨ `grep` æˆ– IDE æœç´¢
3. **æŸ¥çœ‹æµ‹è¯•** - æµ‹è¯•ä»£ç æ˜¯æœ€å¥½çš„ç¤ºä¾‹
4. **æé—®** - åœ¨é¡¹ç›®ç¾¤ç»„æˆ–Issuesä¸­æé—®

---

**æ¬¢è¿åŠ å…¥ZKFair L2é¡¹ç›®ï¼** ğŸš€

> "The best way to learn is by doing. Start small, think big!"

æœ€åæ›´æ–°ï¼š2024å¹´